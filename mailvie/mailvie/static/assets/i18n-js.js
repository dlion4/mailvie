import{uniq as e,camelCase as n,repeat as r,get as i,zipObject as s,sortBy as o,flattenDeep as a,isArray as l,isObject as c,range as u,set as h,has as d}from"lodash";import g from"bignumber.js";const defaultLocaleResolver=(n,r)=>{const i=[];const s=[];i.push(r);r||i.push(n.locale);n.enableFallback&&i.push(n.defaultLocale);i.filter(Boolean).map((e=>e.toString())).forEach((function(e){s.includes(e)||s.push(e);if(!n.enableFallback)return;const r=e.split("-");3===r.length&&s.push(`${r[0]}-${r[1]}`);s.push(r[0])}));return e(s)};class Locales{constructor(e){this.i18n=e;this.registry={};this.register("default",defaultLocaleResolver)}register(e,n){if("function"!==typeof n){const e=n;n=()=>e}this.registry[e]=n}get(e){let n=this.registry[e]||this.registry[this.i18n.locale]||this.registry.default;"function"===typeof n&&(n=n(this.i18n,e));n instanceof Array||(n=[n]);return n}}const defaultPluralizer=(e,n)=>{switch(n){case 0:return["zero","other"];case 1:return["one"];default:return["other"]}};class Pluralization{constructor(e){this.i18n=e;this.registry={};this.register("default",defaultPluralizer)}register(e,n){this.registry[e]=n}get(e){return this.registry[e]||this.registry[this.i18n.locale]||this.registry.default}}function camelCaseKeys(e){return e?Object.keys(e).reduce(((r,i)=>{r[n(i)]=e[i];return r}),{}):{}}function isSet(e){return void 0!==e&&null!==e}function createTranslationOptions(e,n,r){let i=[{scope:n}];isSet(r.defaults)&&(i=i.concat(r.defaults));if(isSet(r.defaultValue)){const s="function"===typeof r.defaultValue?r.defaultValue(e,n,r):r.defaultValue;i.push({message:s});delete r.defaultValue}return i}var p;(function(e){e[e.up=g.ROUND_UP]="up";e[e.down=g.ROUND_DOWN]="down";e[e.truncate=g.ROUND_DOWN]="truncate";e[e.halfUp=g.ROUND_HALF_UP]="halfUp";e[e.default=g.ROUND_HALF_UP]="default";e[e.halfDown=g.ROUND_HALF_DOWN]="halfDown";e[e.halfEven=g.ROUND_HALF_EVEN]="halfEven";e[e.banker=g.ROUND_HALF_EVEN]="banker";e[e.ceiling=g.ROUND_CEIL]="ceiling";e[e.ceil=g.ROUND_CEIL]="ceil";e[e.floor=g.ROUND_FLOOR]="floor"})(p||(p={}));function expandRoundMode(e){var n;return null!==(n=p[e])&&void 0!==n?n:p.default}function replaceInFormat(e,{formattedNumber:n,unit:r}){return e.replace("%n",n).replace("%u",r)}function computeSignificand({significand:e,whole:n,precision:r}){if("0"===n||null===r)return e;const i=Math.max(0,r-n.length);return(null!==e&&void 0!==e?e:"").substr(0,i)}function formatNumber(e,n){var i,s,o;const a=new g(e);if(n.raise&&!a.isFinite())throw new Error(`"${e}" is not a valid numeric value`);const l=roundNumber(a,n);const c=new g(l);const u=c.lt(0);const h=c.isZero();let[d,p]=l.split(".");const f=[];let m;const b=null!==(i=n.format)&&void 0!==i?i:"%n";const y=null!==(s=n.negativeFormat)&&void 0!==s?s:`-${b}`;const S=u&&!h?y:b;d=d.replace("-","");while(d.length>0){f.unshift(d.substr(Math.max(0,d.length-3),3));d=d.substr(0,d.length-3)}d=f.join("");m=f.join(n.delimiter);p=n.significant?computeSignificand({whole:d,significand:p,precision:n.precision}):null!==p&&void 0!==p?p:r("0",null!==(o=n.precision)&&void 0!==o?o:0);n.stripInsignificantZeros&&p&&(p=p.replace(/0+$/,""));a.isNaN()&&(m=e.toString());p&&a.isFinite()&&(m+=(n.separator||".")+p);return replaceInFormat(S,{formattedNumber:m,unit:n.unit})}function getFullScope(e,n,r){let i="";(n instanceof String||"string"===typeof n)&&(i=n);n instanceof Array&&(i=n.join(e.defaultSeparator));r.scope&&(i=[r.scope,i].join(e.defaultSeparator));return i}function inferType(e){var n,r;if(null===e)return"null";const i=typeof e;return"object"!==i?i:(null===(r=null===(n=null===e||void 0===e?void 0:e.constructor)||void 0===n?void 0:n.name)||void 0===r?void 0:r.toLowerCase())||"object"}function interpolate(e,n,r){r=Object.keys(r).reduce(((n,i)=>{n[e.transformKey(i)]=r[i];return n}),{});const i=n.match(e.placeholder);if(!i)return n;while(i.length){let s;const o=i.shift();const a=o.replace(e.placeholder,"$1");s=isSet(r[a])?r[a].toString().replace(/\$/gm,"_#$#_"):a in r?e.nullPlaceholder(e,o,n,r):e.missingPlaceholder(e,o,n,r);const l=new RegExp(o.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}"));n=n.replace(l,s)}return n.replace(/_#\$#_/g,"$")}function lookup(e,n,r={}){r=Object.assign({},r);const s="locale"in r?r.locale:e.locale;const o=inferType(s);const a=e.locales.get("string"===o?s:typeof s).slice();n=getFullScope(e,n,r).split(e.defaultSeparator).map((n=>e.transformKey(n))).join(".");const l=a.map((r=>i(e.translations,[r,n].join("."))));l.push(r.defaultValue);return l.find((e=>isSet(e)))}function numberToDelimited(e,n){const r=new g(e);if(!r.isFinite())return e.toString();if(!n.delimiterPattern.global)throw new Error(`options.delimiterPattern must be a global regular expression; received ${n.delimiterPattern}`);let[i,s]=r.toString().split(".");i=i.replace(n.delimiterPattern,(e=>`${e}${n.delimiter}`));return[i,s].filter(Boolean).join(n.separator)}function digitCount(e){return e.isZero()?1:Math.floor(Math.log10(e.abs().toNumber())+1)}function getAbsolutePrecision(e,{precision:n,significant:r}){return r&&null!==n&&n>0?n-digitCount(e):n}function roundNumber(e,n){const r=getAbsolutePrecision(e,n);if(null===r)return e.toString();const i=expandRoundMode(n.roundMode);if(r>=0)return e.toFixed(r,i);const s=Math.pow(10,Math.abs(r));e=new g(e.div(s).toFixed(0,i)).times(s);return e.toString()}const f={0:"unit",1:"ten",2:"hundred",3:"thousand",6:"million",9:"billion",12:"trillion",15:"quadrillion","-1":"deci","-2":"centi","-3":"mili","-6":"micro","-9":"nano","-12":"pico","-15":"femto"};const m=s(Object.values(f),Object.keys(f).map((e=>parseInt(e,10))));function numberToHuman(e,n,r){const i={roundMode:r.roundMode,precision:r.precision,significant:r.significant};let s;if("string"===inferType(r.units)){const n=r.units;s=lookup(e,n);if(!s)throw new Error(`The scope "${e.locale}${e.defaultSeparator}${getFullScope(e,n,{})}" couldn't be found`)}else s=r.units;let a=roundNumber(new g(n),i);const unitExponents=e=>o(Object.keys(e).map((e=>m[e])),(e=>-1*e));const calculateExponent=(e,n)=>{const r=e.isZero()?0:Math.floor(Math.log10(e.abs().toNumber()));return unitExponents(n).find((e=>r>=e))||0};const determineUnit=(e,n)=>{const r=f[n.toString()];return e[r]||""};const l=calculateExponent(new g(a),s);const c=determineUnit(s,l);a=roundNumber(new g(a).div(Math.pow(10,l)),i);if(r.stripInsignificantZeros){let[e,n]=a.split(".");n=(n||"").replace(/0+$/,"");a=e;n&&(a+=`${r.separator}${n}`)}return r.format.replace("%n",a||"0").replace("%u",c).trim()}const b=["byte","kb","mb","gb","tb","pb","eb"];function numberToHumanSize(e,n,r){const i=expandRoundMode(r.roundMode);const s=1024;const o=new g(n).abs();const a=o.lt(s);let l;const computeExponent=(e,n)=>{const r=n.length-1;const i=new g(Math.log(e.toNumber())).div(Math.log(s)).integerValue(g.ROUND_DOWN).toNumber();return Math.min(r,i)};const storageUnitKey=e=>{const n=a?"byte":e[c];return`number.human.storage_units.units.${n}`};const c=computeExponent(o,b);l=a?o.integerValue():new g(roundNumber(o.div(Math.pow(s,c)),{significant:r.significant,precision:r.precision,roundMode:r.roundMode}));const u=e.translate("number.human.storage_units.format",{defaultValue:"%n %u"});const h=e.translate(storageUnitKey(b),{count:o.integerValue().toNumber()});let d=l.toFixed(r.precision,i);r.stripInsignificantZeros&&(d=d.replace(/(\..*?)0+$/,"$1").replace(/\.$/,""));return u.replace("%n",d).replace("%u",h)}function parseDate(e){if(e instanceof Date)return e;if("number"===typeof e){const n=new Date;n.setTime(e);return n}const n=new String(e).match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2})(?:[.,](\d{1,3}))?)?(Z|\+00:?00)?/);if(n){const e=n.slice(1,8).map((e=>parseInt(e,10)||0));e[1]-=1;const[r,i,s,o,a,l,c]=e;const u=n[8];return u?new Date(Date.UTC(r,i,s,o,a,l,c)):new Date(r,i,s,o,a,l,c)}if(e.match(/([A-Z][a-z]{2}) ([A-Z][a-z]{2}) (\d+) (\d+:\d+:\d+) ([+-]\d+) (\d+)/)){const e=new Date;e.setTime(Date.parse([RegExp.$1,RegExp.$2,RegExp.$3,RegExp.$6,RegExp.$4,RegExp.$5].join(" ")))}const r=new Date;r.setTime(Date.parse(e));return r}function pluralize(e,n,r,i){i=Object.assign({},i);let s;let o;s="object"===typeof r&&r?r:lookup(e,r,i);if(!s)return e.missingTranslation.get(r,i);const a=e.pluralization.get(i.locale);const l=a(e,n);while(l.length){const e=l.shift();if(isSet(s[e])){o=s[e];break}}i.count=n;return e.interpolate(e,o,i)}class PropertyFlatList{constructor(e){this.target=e}call(){const e=a(Object.keys(this.target).map((e=>this.compute(this.target[e],e))));e.sort();return e}compute(e,n){return!l(e)&&c(e)?Object.keys(e).map((r=>this.compute(e[r],`${n}.${r}`))):n}}function propertyFlatList(e){return new PropertyFlatList(e).call()}const y={meridian:{am:"AM",pm:"PM"},dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbrDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],monthNames:[null,"January","February","March","April","May","June","July","August","September","October","November","December"],abbrMonthNames:[null,"Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]};function strftime(e,n,r={}){const{abbrDayNames:i,dayNames:s,abbrMonthNames:o,monthNames:a,meridian:l}=Object.assign(Object.assign({},y),r);if(isNaN(e.getTime()))throw new Error("strftime() requires a valid date object, but received an invalid date.");const c=e.getDay();const u=e.getDate();const h=e.getFullYear();const d=e.getMonth()+1;const g=e.getHours();let p=g;const f=g>11?"pm":"am";const m=e.getSeconds();const b=e.getMinutes();const S=e.getTimezoneOffset();const _=Math.floor(Math.abs(S/60));const w=Math.abs(S)-60*_;const O=(S>0?"-":"+")+(_.toString().length<2?"0"+_:_)+(w.toString().length<2?"0"+w:w);p>12?p-=12:0===p&&(p=12);n=n.replace("%a",i[c]);n=n.replace("%A",s[c]);n=n.replace("%b",o[d]);n=n.replace("%B",a[d]);n=n.replace("%d",u.toString().padStart(2,"0"));n=n.replace("%e",u.toString());n=n.replace("%-d",u.toString());n=n.replace("%H",g.toString().padStart(2,"0"));n=n.replace("%-H",g.toString());n=n.replace("%k",g.toString());n=n.replace("%I",p.toString().padStart(2,"0"));n=n.replace("%-I",p.toString());n=n.replace("%l",p.toString());n=n.replace("%m",d.toString().padStart(2,"0"));n=n.replace("%-m",d.toString());n=n.replace("%M",b.toString().padStart(2,"0"));n=n.replace("%-M",b.toString());n=n.replace("%p",l[f]);n=n.replace("%P",l[f].toLowerCase());n=n.replace("%S",m.toString().padStart(2,"0"));n=n.replace("%-S",m.toString());n=n.replace("%w",c.toString());n=n.replace("%y",h.toString().padStart(2,"0").substr(-2));n=n.replace("%-y",h.toString().padStart(2,"0").substr(-2).replace(/^0+/,""));n=n.replace("%Y",h.toString());n=n.replace(/%z/i,O);return n}const within=(e,n,r)=>r>=e&&r<=n;function timeAgoInWords(e,n,r,i={}){const s=i.scope||"datetime.distance_in_words";const t=(n,r=0)=>e.t(n,{count:r,scope:s});n=parseDate(n);r=parseDate(r);let o=n.getTime()/1e3;let a=r.getTime()/1e3;o>a&&([n,r,o,a]=[r,n,a,o]);const l=Math.round(a-o);const c=Math.round((a-o)/60);const h=c/60;const d=h/24;const g=Math.round(c/60);const p=Math.round(d);const f=Math.round(p/30);if(within(0,1,c))return i.includeSeconds?within(0,4,l)?t("less_than_x_seconds",5):within(5,9,l)?t("less_than_x_seconds",10):within(10,19,l)?t("less_than_x_seconds",20):within(20,39,l)?t("half_a_minute"):within(40,59,l)?t("less_than_x_minutes",1):t("x_minutes",1):0===c?t("less_than_x_minutes",1):t("x_minutes",c);if(within(2,44,c))return t("x_minutes",c);if(within(45,89,c))return t("about_x_hours",1);if(within(90,1439,c))return t("about_x_hours",g);if(within(1440,2519,c))return t("x_days",1);if(within(2520,43199,c))return t("x_days",p);if(within(43200,86399,c))return t("about_x_months",Math.round(c/43200));if(within(86400,525599,c))return t("x_months",f);let m=n.getFullYear();n.getMonth()+1>=3&&(m+=1);let b=r.getFullYear();r.getMonth()+1<3&&(b-=1);const y=m>b?0:u(m,b).filter((e=>1==new Date(e,1,29).getMonth())).length;const S=525600;const _=1440*y;const w=c-_;const O=Math.trunc(w/S);const j=parseFloat((w/S-O).toPrecision(3));return j<.25?t("about_x_years",O):j<.75?t("over_x_years",O):t("almost_x_years",O+1)}const guessStrategy=function(e,n){n instanceof Array&&(n=n.join(e.defaultSeparator));const r=n.split(e.defaultSeparator).slice(-1)[0];return e.missingTranslationPrefix+r.replace("_"," ").replace(/([a-z])([A-Z])/g,((e,n,r)=>`${n} ${r.toLowerCase()}`))};const messageStrategy=(e,n,r)=>{const i=getFullScope(e,n,r);const s="locale"in r?r.locale:e.locale;const o=inferType(s);const a=["string"==o?s:o,i].join(e.defaultSeparator);return`[missing "${a}" translation]`};const errorStrategy=(e,n,r)=>{const i=getFullScope(e,n,r);const s=[e.locale,i].join(e.defaultSeparator);throw new Error(`Missing translation: ${s}`)};class MissingTranslation{constructor(e){this.i18n=e;this.registry={};this.register("guess",guessStrategy);this.register("message",messageStrategy);this.register("error",errorStrategy)}register(e,n){this.registry[e]=n}get(e,n){var r;return this.registry[null!==(r=n.missingBehavior)&&void 0!==r?r:this.i18n.missingBehavior](this.i18n,e,n)}}var S=(void 0,function(e,n,r,i){function adopt(e){return e instanceof r?e:new r((function(n){n(e)}))}return new(r||(r=Promise))((function(r,s){function fulfilled(e){try{step(i.next(e))}catch(e){s(e)}}function rejected(e){try{step(i.throw(e))}catch(e){s(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((i=i.apply(e,n||[])).next())}))});const _={defaultLocale:"en",locale:"en",defaultSeparator:".",placeholder:/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,enableFallback:false,missingBehavior:"message",missingTranslationPrefix:"",missingPlaceholder:(e,n)=>`[missing "${n}" value]`,nullPlaceholder:(e,n,r,i)=>e.missingPlaceholder(e,n,r,i),transformKey:e=>e};class I18n{constructor(e={},n={}){this._locale=_.locale;this._defaultLocale=_.defaultLocale;this._version=0;this.onChangeHandlers=[];this.translations={};this.t=this.translate;this.p=this.pluralize;this.l=this.localize;this.distanceOfTimeInWords=this.timeAgoInWords;const{locale:r,enableFallback:i,missingBehavior:s,missingTranslationPrefix:o,missingPlaceholder:a,nullPlaceholder:l,defaultLocale:c,defaultSeparator:u,placeholder:h,transformKey:d}=Object.assign(Object.assign({},_),n);this.locale=r;this.defaultLocale=c;this.defaultSeparator=u;this.enableFallback=i;this.locale=r;this.missingBehavior=s;this.missingTranslationPrefix=o;this.missingPlaceholder=a;this.nullPlaceholder=l;this.placeholder=h;this.pluralization=new Pluralization(this);this.locales=new Locales(this);this.missingTranslation=new MissingTranslation(this);this.transformKey=d;this.interpolate=interpolate;this.store(e)}store(e){const n=propertyFlatList(e);n.forEach((n=>h(this.translations,n,i(e,n))));this.hasChanged()}get locale(){return this._locale||this.defaultLocale||"en"}set locale(e){if("string"!==typeof e)throw new Error(`Expected newLocale to be a string; got ${inferType(e)}`);const n=this._locale!==e;this._locale=e;n&&this.hasChanged()}get defaultLocale(){return this._defaultLocale||"en"}set defaultLocale(e){if("string"!==typeof e)throw new Error(`Expected newLocale to be a string; got ${inferType(e)}`);const n=this._defaultLocale!==e;this._defaultLocale=e;n&&this.hasChanged()}translate(e,n){n=Object.assign({},n);const r=createTranslationOptions(this,e,n);let i;const s=r.some((e=>{isSet(e.scope)?i=lookup(this,e.scope,n):isSet(e.message)&&(i=e.message);return void 0!==i&&null!==i}));if(!s)return this.missingTranslation.get(e,n);"string"===typeof i?i=this.interpolate(this,i,n):"object"===typeof i&&i&&isSet(n.count)&&(i=this.pluralize(n.count||0,i,n));return i}pluralize(e,n,r){return pluralize(this,e,n,Object.assign({},r))}localize(e,n,r){r=Object.assign({},r);if(void 0===n||null===n)return"";switch(e){case"currency":return this.numberToCurrency(n);case"number":return formatNumber(n,Object.assign({delimiter:",",precision:3,separator:".",significant:false,stripInsignificantZeros:false},lookup(this,"number.format")));case"percentage":return this.numberToPercentage(n);default:{let i;i=e.match(/^(date|time)/)?this.toTime(e,n):n.toString();return interpolate(this,i,r)}}}toTime(e,n){const r=parseDate(n);const i=lookup(this,e);return r.toString().match(/invalid/i)?r.toString():i?this.strftime(r,i):r.toString()}numberToCurrency(e,n={}){return formatNumber(e,Object.assign(Object.assign(Object.assign({delimiter:",",format:"%u%n",precision:2,separator:".",significant:false,stripInsignificantZeros:false,unit:"$"},camelCaseKeys(this.get("number.format"))),camelCaseKeys(this.get("number.currency.format"))),n))}numberToPercentage(e,n={}){return formatNumber(e,Object.assign(Object.assign(Object.assign({delimiter:"",format:"%n%",precision:3,stripInsignificantZeros:false,separator:".",significant:false},camelCaseKeys(this.get("number.format"))),camelCaseKeys(this.get("number.percentage.format"))),n))}numberToHumanSize(e,n={}){return numberToHumanSize(this,e,Object.assign(Object.assign(Object.assign({delimiter:"",precision:3,significant:true,stripInsignificantZeros:true,units:{billion:"Billion",million:"Million",quadrillion:"Quadrillion",thousand:"Thousand",trillion:"Trillion",unit:""}},camelCaseKeys(this.get("number.human.format"))),camelCaseKeys(this.get("number.human.storage_units"))),n))}numberToHuman(e,n={}){return numberToHuman(this,e,Object.assign(Object.assign(Object.assign({delimiter:"",separator:".",precision:3,significant:true,stripInsignificantZeros:true,format:"%n %u",roundMode:"default",units:{billion:"Billion",million:"Million",quadrillion:"Quadrillion",thousand:"Thousand",trillion:"Trillion",unit:""}},camelCaseKeys(this.get("number.human.format"))),camelCaseKeys(this.get("number.human.decimal_units"))),n))}numberToRounded(e,n){return formatNumber(e,Object.assign({unit:"",precision:3,significant:false,separator:".",delimiter:"",stripInsignificantZeros:false},n))}numberToDelimited(e,n={}){return numberToDelimited(e,Object.assign({delimiterPattern:/(\d)(?=(\d\d\d)+(?!\d))/g,delimiter:",",separator:"."},n))}withLocale(e,n){return S(this,void 0,void 0,(function*(){const r=this.locale;try{this.locale=e;yield n()}finally{this.locale=r}}))}strftime(e,n,r={}){return strftime(e,n,Object.assign(Object.assign(Object.assign({},camelCaseKeys(lookup(this,"date"))),{meridian:{am:lookup(this,"time.am")||"AM",pm:lookup(this,"time.pm")||"PM"}}),r))}update(e,n,r={strict:false}){if(r.strict&&!d(this.translations,e))throw new Error(`The path "${e}" is not currently defined`);const s=i(this.translations,e);const o=inferType(s);const a=inferType(n);if(r.strict&&o!==a)throw new Error(`The current type for "${e}" is "${o}", but you're trying to override it with "${a}"`);let l;l="object"===a?Object.assign(Object.assign({},s),n):n;h(this.translations,e,l);this.hasChanged()}toSentence(e,n={}){const{wordsConnector:r,twoWordsConnector:i,lastWordConnector:s}=Object.assign(Object.assign({wordsConnector:", ",twoWordsConnector:" and ",lastWordConnector:", and "},camelCaseKeys(lookup(this,"support.array"))),n);const o=e.length;switch(o){case 0:return"";case 1:return`${e[0]}`;case 2:return e.join(i);default:return[e.slice(0,o-1).join(r),s,e[o-1]].join("")}}timeAgoInWords(e,n,r={}){return timeAgoInWords(this,e,n,r)}onChange(e){this.onChangeHandlers.push(e);return()=>{this.onChangeHandlers.splice(this.onChangeHandlers.indexOf(e),1)}}get version(){return this._version}get(e){return lookup(this,e)}runCallbacks(){this.onChangeHandlers.forEach((e=>e(this)))}hasChanged(){this._version+=1;this.runCallbacks()}}export{I18n,Locales,MissingTranslation,Pluralization};