import*as t from"underscore";import*as e from"jquery";var i="default"in t?t.default:t;var r="default"in e?e.default:e;var n="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:global;var s={};(function(t){var e="object"==typeof self&&self.self===self&&self||"object"==typeof n&&n.global===n&&n;var a,h=i;try{a=r}catch(t){}t(e,s,h,a)})((function(t,e,i,r){var s=t.Backbone;var a=Array.prototype.slice;e.VERSION="1.4.1";e.$=r;e.noConflict=function(){t.Backbone=s;return this||n};e.emulateHTTP=false;e.emulateJSON=false;var h=e.Events={};var o=/\s+/;var l;var eventsApi=function(t,e,r,n,s){var a,h=0;if(r&&"object"===typeof r){void 0!==n&&"context"in s&&void 0===s.context&&(s.context=n);for(a=i.keys(r);h<a.length;h++)e=eventsApi(t,e,a[h],r[a[h]],s)}else if(r&&o.test(r))for(a=r.split(o);h<a.length;h++)e=t(e,a[h],n,s);else e=t(e,r,n,s);return e};h.on=function(t,e,i){(this||n)._events=eventsApi(onApi,(this||n)._events||{},t,e,{context:i,ctx:this||n,listening:l});if(l){var r=(this||n)._listeners||((this||n)._listeners={});r[l.id]=l;l.interop=false}return this||n};h.listenTo=function(t,e,r){if(!t)return this||n;var s=t._listenId||(t._listenId=i.uniqueId("l"));var a=(this||n)._listeningTo||((this||n)._listeningTo={});var h=l=a[s];if(!h){(this||n)._listenId||((this||n)._listenId=i.uniqueId("l"));h=l=a[s]=new Listening(this||n,t)}var o=tryCatchOn(t,e,r,this||n);l=void 0;if(o)throw o;h.interop&&h.on(e,r);return this||n};var onApi=function(t,e,i,r){if(i){var n=t[e]||(t[e]=[]);var s=r.context,a=r.ctx,h=r.listening;h&&h.count++;n.push({callback:i,context:s,ctx:s||a,listening:h})}return t};var tryCatchOn=function(t,e,i,r){try{t.on(e,i,r)}catch(t){return t}};h.off=function(t,e,i){if(!(this||n)._events)return this||n;(this||n)._events=eventsApi(offApi,(this||n)._events,t,e,{context:i,listeners:(this||n)._listeners});return this||n};h.stopListening=function(t,e,r){var s=(this||n)._listeningTo;if(!s)return this||n;var a=t?[t._listenId]:i.keys(s);for(var h=0;h<a.length;h++){var o=s[a[h]];if(!o)break;o.obj.off(e,r,this||n);o.interop&&o.off(e,r)}i.isEmpty(s)&&((this||n)._listeningTo=void 0);return this||n};var offApi=function(t,e,r,n){if(t){var s=n.context,a=n.listeners;var h,o=0;if(e||s||r){h=e?[e]:i.keys(t);for(;o<h.length;o++){e=h[o];var l=t[e];if(!l)break;var u=[];for(var c=0;c<l.length;c++){var f=l[c];if(r&&r!==f.callback&&r!==f.callback._callback||s&&s!==f.context)u.push(f);else{var d=f.listening;d&&d.off(e,r)}}u.length?t[e]=u:delete t[e]}return t}for(h=i.keys(a);o<h.length;o++)a[h[o]].cleanup()}};h.once=function(t,e,i){var r=eventsApi(onceMap,{},t,e,(this||n).off.bind(this||n));"string"===typeof t&&null==i&&(e=void 0);return this.on(r,e,i)};h.listenToOnce=function(t,e,i){var r=eventsApi(onceMap,{},e,i,(this||n).stopListening.bind(this||n,t));return this.listenTo(t,r)};var onceMap=function(t,e,r,s){if(r){var a=t[e]=i.once((function(){s(e,a);r.apply(this||n,arguments)}));a._callback=r}return t};h.trigger=function(t){if(!(this||n)._events)return this||n;var e=Math.max(0,arguments.length-1);var i=Array(e);for(var r=0;r<e;r++)i[r]=arguments[r+1];eventsApi(triggerApi,(this||n)._events,t,void 0,i);return this||n};var triggerApi=function(t,e,i,r){if(t){var n=t[e];var s=t.all;n&&s&&(s=s.slice());n&&triggerEvents(n,r);s&&triggerEvents(s,[e].concat(r))}return t};var triggerEvents=function(t,e){var i,r=-1,n=t.length,s=e[0],a=e[1],h=e[2];switch(e.length){case 0:while(++r<n)(i=t[r]).callback.call(i.ctx);return;case 1:while(++r<n)(i=t[r]).callback.call(i.ctx,s);return;case 2:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a);return;case 3:while(++r<n)(i=t[r]).callback.call(i.ctx,s,a,h);return;default:while(++r<n)(i=t[r]).callback.apply(i.ctx,e);return}};var Listening=function(t,e){(this||n).id=t._listenId;(this||n).listener=t;(this||n).obj=e;(this||n).interop=true;(this||n).count=0;(this||n)._events=void 0};Listening.prototype.on=h.on;Listening.prototype.off=function(t,e){var i;if((this||n).interop){(this||n)._events=eventsApi(offApi,(this||n)._events,t,e,{context:void 0,listeners:void 0});i=!(this||n)._events}else{(this||n).count--;i=0===(this||n).count}i&&this.cleanup()};Listening.prototype.cleanup=function(){delete(this||n).listener._listeningTo[(this||n).obj._listenId];(this||n).interop||delete(this||n).obj._listeners[(this||n).id]};h.bind=h.on;h.unbind=h.off;i.extend(e,h);var u=e.Model=function(t,e){var r=t||{};e||(e={});(this||n).preinitialize.apply(this||n,arguments);(this||n).cid=i.uniqueId((this||n).cidPrefix);(this||n).attributes={};e.collection&&((this||n).collection=e.collection);e.parse&&(r=this.parse(r,e)||{});var s=i.result(this||n,"defaults");r=i.defaults(i.extend({},s,r),s);this.set(r,e);(this||n).changed={};(this||n).initialize.apply(this||n,arguments)};i.extend(u.prototype,h,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",preinitialize:function(){},initialize:function(){},toJSON:function(t){return i.clone((this||n).attributes)},sync:function(){return e.sync.apply(this||n,arguments)},get:function(t){return(this||n).attributes[t]},escape:function(t){return i.escape(this.get(t))},has:function(t){return null!=this.get(t)},matches:function(t){return!!i.iteratee(t,this||n)((this||n).attributes)},set:function(t,e,r){if(null==t)return this||n;var s;if("object"===typeof t){s=t;r=e}else(s={})[t]=e;r||(r={});if(!this._validate(s,r))return false;var a=r.unset;var h=r.silent;var o=[];var l=(this||n)._changing;(this||n)._changing=true;if(!l){(this||n)._previousAttributes=i.clone((this||n).attributes);(this||n).changed={}}var u=(this||n).attributes;var c=(this||n).changed;var f=(this||n)._previousAttributes;for(var d in s){e=s[d];i.isEqual(u[d],e)||o.push(d);i.isEqual(f[d],e)?delete c[d]:c[d]=e;a?delete u[d]:u[d]=e}if((this||n).idAttribute in s){var v=(this||n).id;(this||n).id=this.get((this||n).idAttribute);this.trigger("changeId",this||n,v,r)}if(!h){o.length&&((this||n)._pending=r);for(var p=0;p<o.length;p++)this.trigger("change:"+o[p],this||n,u[o[p]],r)}if(l)return this||n;if(!h)while((this||n)._pending){r=(this||n)._pending;(this||n)._pending=false;this.trigger("change",this||n,r)}(this||n)._pending=false;(this||n)._changing=false;return this||n},unset:function(t,e){return this.set(t,void 0,i.extend({},e,{unset:true}))},clear:function(t){var e={};for(var r in(this||n).attributes)e[r]=void 0;return this.set(e,i.extend({},t,{unset:true}))},hasChanged:function(t){return null==t?!i.isEmpty((this||n).changed):i.has((this||n).changed,t)},changedAttributes:function(t){if(!t)return!!this.hasChanged()&&i.clone((this||n).changed);var e=(this||n)._changing?(this||n)._previousAttributes:(this||n).attributes;var r={};var s;for(var a in t){var h=t[a];if(!i.isEqual(e[a],h)){r[a]=h;s=true}}return!!s&&r},previous:function(t){return null!=t&&(this||n)._previousAttributes?(this||n)._previousAttributes[t]:null},previousAttributes:function(){return i.clone((this||n)._previousAttributes)},fetch:function(t){t=i.extend({parse:true},t);var e=this||n;var r=t.success;t.success=function(i){var n=t.parse?e.parse(i,t):i;if(!e.set(n,t))return false;r&&r.call(t.context,e,i,t);e.trigger("sync",e,i,t)};wrapError(this||n,t);return this.sync("read",this||n,t)},save:function(t,e,r){var s;if(null==t||"object"===typeof t){s=t;r=e}else(s={})[t]=e;r=i.extend({validate:true,parse:true},r);var a=r.wait;if(s&&!a){if(!this.set(s,r))return false}else if(!this._validate(s,r))return false;var h=this||n;var o=r.success;var l=(this||n).attributes;r.success=function(t){h.attributes=l;var e=r.parse?h.parse(t,r):t;a&&(e=i.extend({},s,e));if(e&&!h.set(e,r))return false;o&&o.call(r.context,h,t,r);h.trigger("sync",h,t,r)};wrapError(this||n,r);s&&a&&((this||n).attributes=i.extend({},l,s));var u=this.isNew()?"create":r.patch?"patch":"update";"patch"!==u||r.attrs||(r.attrs=s);var c=this.sync(u,this||n,r);(this||n).attributes=l;return c},destroy:function(t){t=t?i.clone(t):{};var e=this||n;var r=t.success;var s=t.wait;var destroy=function(){e.stopListening();e.trigger("destroy",e,e.collection,t)};t.success=function(i){s&&destroy();r&&r.call(t.context,e,i,t);e.isNew()||e.trigger("sync",e,i,t)};var a=false;if(this.isNew())i.defer(t.success);else{wrapError(this||n,t);a=this.sync("delete",this||n,t)}s||destroy();return a},url:function(){var t=i.result(this||n,"urlRoot")||i.result((this||n).collection,"url")||urlError();if(this.isNew())return t;var e=this.get((this||n).idAttribute);return t.replace(/[^\/]$/,"$&/")+encodeURIComponent(e)},parse:function(t,e){return t},clone:function(){return new(this||n).constructor((this||n).attributes)},isNew:function(){return!this.has((this||n).idAttribute)},isValid:function(t){return this._validate({},i.extend({},t,{validate:true}))},_validate:function(t,e){if(!e.validate||!(this||n).validate)return true;t=i.extend({},(this||n).attributes,t);var r=(this||n).validationError=this.validate(t,e)||null;if(!r)return true;this.trigger("invalid",this||n,r,i.extend(e,{validationError:r}));return false}});var c=e.Collection=function(t,e){e||(e={});(this||n).preinitialize.apply(this||n,arguments);e.model&&((this||n).model=e.model);void 0!==e.comparator&&((this||n).comparator=e.comparator);this._reset();(this||n).initialize.apply(this||n,arguments);t&&this.reset(t,i.extend({silent:true},e))};var f={add:true,remove:true,merge:true};var d={add:true,remove:false};var splice=function(t,e,i){i=Math.min(Math.max(i,0),t.length);var r=Array(t.length-i);var n=e.length;var s;for(s=0;s<r.length;s++)r[s]=t[s+i];for(s=0;s<n;s++)t[s+i]=e[s];for(s=0;s<r.length;s++)t[s+n+i]=r[s]};i.extend(c.prototype,h,{model:u,preinitialize:function(){},initialize:function(){},toJSON:function(t){return this.map((function(e){return e.toJSON(t)}))},sync:function(){return e.sync.apply(this||n,arguments)},add:function(t,e){return this.set(t,i.extend({merge:false},e,d))},remove:function(t,e){e=i.extend({},e);var r=!i.isArray(t);t=r?[t]:t.slice();var s=this._removeModels(t,e);if(!e.silent&&s.length){e.changes={added:[],merged:[],removed:s};this.trigger("update",this||n,e)}return r?s[0]:s},set:function(t,e){if(null!=t){e=i.extend({},f,e);e.parse&&!this._isModel(t)&&(t=this.parse(t,e)||[]);var r=!i.isArray(t);t=r?[t]:t.slice();var s=e.at;null!=s&&(s=+s);s>(this||n).length&&(s=(this||n).length);s<0&&(s+=(this||n).length+1);var a=[];var h=[];var o=[];var l=[];var u={};var c=e.add;var d=e.merge;var v=e.remove;var p=false;var g=(this||n).comparator&&null==s&&false!==e.sort;var m=i.isString((this||n).comparator)?(this||n).comparator:null;var _,y;for(y=0;y<t.length;y++){_=t[y];var b=this.get(_);if(b){if(d&&_!==b){var x=this._isModel(_)?_.attributes:_;e.parse&&(x=b.parse(x,e));b.set(x,e);o.push(b);g&&!p&&(p=b.hasChanged(m))}if(!u[b.cid]){u[b.cid]=true;a.push(b)}t[y]=b}else if(c){_=t[y]=this._prepareModel(_,e);if(_){h.push(_);this._addReference(_,e);u[_.cid]=true;a.push(_)}}}if(v){for(y=0;y<(this||n).length;y++){_=(this||n).models[y];u[_.cid]||l.push(_)}l.length&&this._removeModels(l,e)}var w=false;var E=!g&&c&&v;if(a.length&&E){w=(this||n).length!==a.length||i.some((this||n).models,(function(t,e){return t!==a[e]}));(this||n).models.length=0;splice((this||n).models,a,0);(this||n).length=(this||n).models.length}else if(h.length){g&&(p=true);splice((this||n).models,h,null==s?(this||n).length:s);(this||n).length=(this||n).models.length}p&&this.sort({silent:true});if(!e.silent){for(y=0;y<h.length;y++){null!=s&&(e.index=s+y);_=h[y];_.trigger("add",_,this||n,e)}(p||w)&&this.trigger("sort",this||n,e);if(h.length||l.length||o.length){e.changes={added:h,removed:l,merged:o};this.trigger("update",this||n,e)}}return r?t[0]:t}},reset:function(t,e){e=e?i.clone(e):{};for(var r=0;r<(this||n).models.length;r++)this._removeReference((this||n).models[r],e);e.previousModels=(this||n).models;this._reset();t=this.add(t,i.extend({silent:true},e));e.silent||this.trigger("reset",this||n,e);return t},push:function(t,e){return this.add(t,i.extend({at:(this||n).length},e))},pop:function(t){var e=this.at((this||n).length-1);return this.remove(e,t)},unshift:function(t,e){return this.add(t,i.extend({at:0},e))},shift:function(t){var e=this.at(0);return this.remove(e,t)},slice:function(){return a.apply((this||n).models,arguments)},get:function(t){if(null!=t)return(this||n)._byId[t]||(this||n)._byId[this.modelId(this._isModel(t)?t.attributes:t,t.idAttribute)]||t.cid&&(this||n)._byId[t.cid]},has:function(t){return null!=this.get(t)},at:function(t){t<0&&(t+=(this||n).length);return(this||n).models[t]},where:function(t,e){return this[e?"find":"filter"](t)},findWhere:function(t){return this.where(t,true)},sort:function(t){var e=(this||n).comparator;if(!e)throw new Error("Cannot sort a set without a comparator");t||(t={});var r=e.length;i.isFunction(e)&&(e=e.bind(this||n));1===r||i.isString(e)?(this||n).models=this.sortBy(e):(this||n).models.sort(e);t.silent||this.trigger("sort",this||n,t);return this||n},pluck:function(t){return this.map(t+"")},fetch:function(t){t=i.extend({parse:true},t);var e=t.success;var r=this||n;t.success=function(i){var n=t.reset?"reset":"set";r[n](i,t);e&&e.call(t.context,r,i,t);r.trigger("sync",r,i,t)};wrapError(this||n,t);return this.sync("read",this||n,t)},create:function(t,e){e=e?i.clone(e):{};var r=e.wait;t=this._prepareModel(t,e);if(!t)return false;r||this.add(t,e);var s=this||n;var a=e.success;e.success=function(t,e,i){r&&s.add(t,i);a&&a.call(i.context,t,e,i)};t.save(null,e);return t},parse:function(t,e){return t},clone:function(){return new(this||n).constructor((this||n).models,{model:(this||n).model,comparator:(this||n).comparator})},modelId:function(t,e){return t[e||(this||n).model.prototype.idAttribute||"id"]},values:function(){return new CollectionIterator(this||n,p)},keys:function(){return new CollectionIterator(this||n,g)},entries:function(){return new CollectionIterator(this||n,m)},_reset:function(){(this||n).length=0;(this||n).models=[];(this||n)._byId={}},_prepareModel:function(t,e){if(this._isModel(t)){t.collection||(t.collection=this||n);return t}e=e?i.clone(e):{};e.collection=this||n;var r;r=(this||n).model.prototype?new(this||n).model(t,e):this.model(t,e);if(!r.validationError)return r;this.trigger("invalid",this||n,r.validationError,e);return false},_removeModels:function(t,e){var i=[];for(var r=0;r<t.length;r++){var s=this.get(t[r]);if(s){var a=this.indexOf(s);(this||n).models.splice(a,1);(this||n).length--;delete(this||n)._byId[s.cid];var h=this.modelId(s.attributes,s.idAttribute);null!=h&&delete(this||n)._byId[h];if(!e.silent){e.index=a;s.trigger("remove",s,this||n,e)}i.push(s);this._removeReference(s,e)}}return i},_isModel:function(t){return t instanceof u},_addReference:function(t,e){(this||n)._byId[t.cid]=t;var i=this.modelId(t.attributes,t.idAttribute);null!=i&&((this||n)._byId[i]=t);t.on("all",(this||n)._onModelEvent,this||n)},_removeReference:function(t,e){delete(this||n)._byId[t.cid];var i=this.modelId(t.attributes,t.idAttribute);null!=i&&delete(this||n)._byId[i];(this||n)===t.collection&&delete t.collection;t.off("all",(this||n)._onModelEvent,this||n)},_onModelEvent:function(t,e,i,r){if(e){if(("add"===t||"remove"===t)&&i!==(this||n))return;"destroy"===t&&this.remove(e,r);if("changeId"===t){var s=this.modelId(e.previousAttributes(),e.idAttribute);var a=this.modelId(e.attributes,e.idAttribute);null!=s&&delete(this||n)._byId[s];null!=a&&((this||n)._byId[a]=e)}}(this||n).trigger.apply(this||n,arguments)}});var v="function"===typeof Symbol&&Symbol.iterator;v&&(c.prototype[v]=c.prototype.values);var CollectionIterator=function(t,e){(this||n)._collection=t;(this||n)._kind=e;(this||n)._index=0};var p=1;var g=2;var m=3;v&&(CollectionIterator.prototype[v]=function(){return this||n});CollectionIterator.prototype.next=function(){if((this||n)._collection){if((this||n)._index<(this||n)._collection.length){var t=(this||n)._collection.at((this||n)._index);(this||n)._index++;var e;if((this||n)._kind===p)e=t;else{var i=(this||n)._collection.modelId(t.attributes,t.idAttribute);e=(this||n)._kind===g?i:[i,t]}return{value:e,done:false}}(this||n)._collection=void 0}return{value:void 0,done:true}};var _=e.View=function(t){(this||n).cid=i.uniqueId("view");(this||n).preinitialize.apply(this||n,arguments);i.extend(this||n,i.pick(t,b));this._ensureElement();(this||n).initialize.apply(this||n,arguments)};var y=/^(\S+)\s*(.*)$/;var b=["model","collection","el","id","attributes","className","tagName","events"];i.extend(_.prototype,h,{tagName:"div",$:function(t){return(this||n).$el.find(t)},preinitialize:function(){},initialize:function(){},render:function(){return this||n},remove:function(){this._removeElement();this.stopListening();return this||n},_removeElement:function(){(this||n).$el.remove()},setElement:function(t){this.undelegateEvents();this._setElement(t);this.delegateEvents();return this||n},_setElement:function(t){(this||n).$el=t instanceof e.$?t:e.$(t);(this||n).el=(this||n).$el[0]},delegateEvents:function(t){t||(t=i.result(this||n,"events"));if(!t)return this||n;this.undelegateEvents();for(var e in t){var r=t[e];i.isFunction(r)||(r=(this||n)[r]);if(r){var s=e.match(y);this.delegate(s[1],s[2],r.bind(this||n))}}return this||n},delegate:function(t,e,i){(this||n).$el.on(t+".delegateEvents"+(this||n).cid,e,i);return this||n},undelegateEvents:function(){(this||n).$el&&(this||n).$el.off(".delegateEvents"+(this||n).cid);return this||n},undelegate:function(t,e,i){(this||n).$el.off(t+".delegateEvents"+(this||n).cid,e,i);return this||n},_createElement:function(t){return document.createElement(t)},_ensureElement:function(){if((this||n).el)this.setElement(i.result(this||n,"el"));else{var t=i.extend({},i.result(this||n,"attributes"));(this||n).id&&(t.id=i.result(this||n,"id"));(this||n).className&&(t.class=i.result(this||n,"className"));this.setElement(this._createElement(i.result(this||n,"tagName")));this._setAttributes(t)}},_setAttributes:function(t){(this||n).$el.attr(t)}});var addMethod=function(t,e,i,r){switch(e){case 1:return function(){return t[i]((this||n)[r])};case 2:return function(e){return t[i]((this||n)[r],e)};case 3:return function(e,s){return t[i]((this||n)[r],cb(e,this||n),s)};case 4:return function(e,s,a){return t[i]((this||n)[r],cb(e,this||n),s,a)};default:return function(){var e=a.call(arguments);e.unshift((this||n)[r]);return t[i].apply(t,e)}}};var addUnderscoreMethods=function(t,e,r,n){i.each(r,(function(i,r){e[r]&&(t.prototype[r]=addMethod(e,i,r,n))}))};var cb=function(t,e){return i.isFunction(t)?t:i.isObject(t)&&!e._isModel(t)?modelMatcher(t):i.isString(t)?function(e){return e.get(t)}:t};var modelMatcher=function(t){var e=i.matches(t);return function(t){return e(t.attributes)}};var x={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};var w={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};i.each([[c,x,"models"],[u,w,"attributes"]],(function(t){var e=t[0],r=t[1],n=t[2];e.mixin=function(t){var r=i.reduce(i.functions(t),(function(t,e){t[e]=0;return t}),{});addUnderscoreMethods(e,t,r,n)};addUnderscoreMethods(e,i,r,n)}));e.sync=function(t,r,s){var a=E[t];i.defaults(s||(s={}),{emulateHTTP:e.emulateHTTP,emulateJSON:e.emulateJSON});var h={type:a,dataType:"json"};s.url||(h.url=i.result(r,"url")||urlError());if(null==s.data&&r&&("create"===t||"update"===t||"patch"===t)){h.contentType="application/json";h.data=JSON.stringify(s.attrs||r.toJSON(s))}if(s.emulateJSON){h.contentType="application/x-www-form-urlencoded";h.data=h.data?{model:h.data}:{}}if(s.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){h.type="POST";s.emulateJSON&&(h.data._method=a);var o=s.beforeSend;s.beforeSend=function(t){t.setRequestHeader("X-HTTP-Method-Override",a);if(o)return o.apply(this||n,arguments)}}"GET"===h.type||s.emulateJSON||(h.processData=false);var l=s.error;s.error=function(t,e,i){s.textStatus=e;s.errorThrown=i;l&&l.call(s.context,t,e,i)};var u=s.xhr=e.ajax(i.extend(h,s));r.trigger("request",r,u,s);return u};var E={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};e.ajax=function(){return e.$.ajax.apply(e.$,arguments)};var I=e.Router=function(t){t||(t={});(this||n).preinitialize.apply(this||n,arguments);t.routes&&((this||n).routes=t.routes);this._bindRoutes();(this||n).initialize.apply(this||n,arguments)};var S=/\((.*?)\)/g;var k=/(\(\?)?:\w+/g;var T=/\*\w+/g;var A=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(I.prototype,h,{preinitialize:function(){},initialize:function(){},route:function(t,r,s){i.isRegExp(t)||(t=this._routeToRegExp(t));if(i.isFunction(r)){s=r;r=""}s||(s=(this||n)[r]);var a=this||n;e.history.route(t,(function(i){var n=a._extractParameters(t,i);if(false!==a.execute(s,n,r)){a.trigger.apply(a,["route:"+r].concat(n));a.trigger("route",r,n);e.history.trigger("route",a,r,n)}}));return this||n},execute:function(t,e,i){t&&t.apply(this||n,e)},navigate:function(t,i){e.history.navigate(t,i);return this||n},_bindRoutes:function(){if((this||n).routes){(this||n).routes=i.result(this||n,"routes");var t,e=i.keys((this||n).routes);while(null!=(t=e.pop()))this.route(t,(this||n).routes[t])}},_routeToRegExp:function(t){t=t.replace(A,"\\$&").replace(S,"(?:$1)?").replace(k,(function(t,e){return e?t:"([^/?]+)"})).replace(T,"([^?]*?)");return new RegExp("^"+t+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(t,e){var r=t.exec(e).slice(1);return i.map(r,(function(t,e){return e===r.length-1?t||null:t?decodeURIComponent(t):null}))}});var P=e.History=function(){(this||n).handlers=[];(this||n).checkUrl=(this||n).checkUrl.bind(this||n);if("undefined"!==typeof window){(this||n).location=window.location;(this||n).history=window.history}};var H=/^[#\/]|\s+$/g;var $=/^\/+|\/+$/g;var C=/#.*$/;P.started=false;i.extend(P.prototype,h,{interval:50,atRoot:function(){var t=(this||n).location.pathname.replace(/[^\/]$/,"$&/");return t===(this||n).root&&!this.getSearch()},matchRoot:function(){var t=this.decodeFragment((this||n).location.pathname);var e=t.slice(0,(this||n).root.length-1)+"/";return e===(this||n).root},decodeFragment:function(t){return decodeURI(t.replace(/%25/g,"%2525"))},getSearch:function(){var t=(this||n).location.href.replace(/#.*/,"").match(/\?.+/);return t?t[0]:""},getHash:function(t){var e=(t||this||n).location.href.match(/#(.*)$/);return e?e[1]:""},getPath:function(){var t=this.decodeFragment((this||n).location.pathname+this.getSearch()).slice((this||n).root.length-1);return"/"===t.charAt(0)?t.slice(1):t},getFragment:function(t){null==t&&(t=(this||n)._usePushState||!(this||n)._wantsHashChange?this.getPath():this.getHash());return t.replace(H,"")},start:function(t){if(P.started)throw new Error("Backbone.history has already been started");P.started=true;(this||n).options=i.extend({root:"/"},(this||n).options,t);(this||n).root=(this||n).options.root;(this||n)._wantsHashChange=false!==(this||n).options.hashChange;(this||n)._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7);(this||n)._useHashChange=(this||n)._wantsHashChange&&(this||n)._hasHashChange;(this||n)._wantsPushState=!!(this||n).options.pushState;(this||n)._hasPushState=!!((this||n).history&&(this||n).history.pushState);(this||n)._usePushState=(this||n)._wantsPushState&&(this||n)._hasPushState;(this||n).fragment=this.getFragment();(this||n).root=("/"+(this||n).root+"/").replace($,"/");if((this||n)._wantsHashChange&&(this||n)._wantsPushState){if(!(this||n)._hasPushState&&!this.atRoot()){var e=(this||n).root.slice(0,-1)||"/";(this||n).location.replace(e+"#"+this.getPath());return true}(this||n)._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:true})}if(!(this||n)._hasHashChange&&(this||n)._wantsHashChange&&!(this||n)._usePushState){(this||n).iframe=document.createElement("iframe");(this||n).iframe.src="javascript:0";(this||n).iframe.style.display="none";(this||n).iframe.tabIndex=-1;var r=document.body;var s=r.insertBefore((this||n).iframe,r.firstChild).contentWindow;s.document.open();s.document.close();s.location.hash="#"+(this||n).fragment}var a=window.addEventListener||function(t,e){return attachEvent("on"+t,e)};(this||n)._usePushState?a("popstate",(this||n).checkUrl,false):(this||n)._useHashChange&&!(this||n).iframe?a("hashchange",(this||n).checkUrl,false):(this||n)._wantsHashChange&&((this||n)._checkUrlInterval=setInterval((this||n).checkUrl,(this||n).interval));if(!(this||n).options.silent)return this.loadUrl()},stop:function(){var t=window.removeEventListener||function(t,e){return detachEvent("on"+t,e)};(this||n)._usePushState?t("popstate",(this||n).checkUrl,false):(this||n)._useHashChange&&!(this||n).iframe&&t("hashchange",(this||n).checkUrl,false);if((this||n).iframe){document.body.removeChild((this||n).iframe);(this||n).iframe=null}(this||n)._checkUrlInterval&&clearInterval((this||n)._checkUrlInterval);P.started=false},route:function(t,e){(this||n).handlers.unshift({route:t,callback:e})},checkUrl:function(t){var e=this.getFragment();e===(this||n).fragment&&(this||n).iframe&&(e=this.getHash((this||n).iframe.contentWindow));if(e===(this||n).fragment)return false;(this||n).iframe&&this.navigate(e);this.loadUrl()},loadUrl:function(t){if(!this.matchRoot())return false;t=(this||n).fragment=this.getFragment(t);return i.some((this||n).handlers,(function(e){if(e.route.test(t)){e.callback(t);return true}}))},navigate:function(t,e){if(!P.started)return false;e&&true!==e||(e={trigger:!!e});t=this.getFragment(t||"");var i=(this||n).root;""!==t&&"?"!==t.charAt(0)||(i=i.slice(0,-1)||"/");var r=i+t;t=t.replace(C,"");var s=this.decodeFragment(t);if((this||n).fragment!==s){(this||n).fragment=s;if((this||n)._usePushState)(this||n).history[e.replace?"replaceState":"pushState"]({},document.title,r);else{if(!(this||n)._wantsHashChange)return(this||n).location.assign(r);this._updateHash((this||n).location,t,e.replace);if((this||n).iframe&&t!==this.getHash((this||n).iframe.contentWindow)){var a=(this||n).iframe.contentWindow;if(!e.replace){a.document.open();a.document.close()}this._updateHash(a.location,t,e.replace)}}return e.trigger?this.loadUrl(t):void 0}},_updateHash:function(t,e,i){if(i){var r=t.href.replace(/(javascript:|#).*$/,"");t.replace(r+"#"+e)}else t.hash="#"+e}});e.history=new P;var extend=function(t,e){var r=this||n;var s;s=t&&i.has(t,"constructor")?t.constructor:function(){return r.apply(this||n,arguments)};i.extend(s,r,e);s.prototype=i.create(r.prototype,t);s.prototype.constructor=s;s.__super__=r.prototype;return s};u.extend=c.extend=I.extend=_.extend=P.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')};var wrapError=function(t,e){var i=e.error;e.error=function(r){i&&i.call(e.context,t,r,e);t.trigger("error",t,r,e)}};return e}));export{s as default};